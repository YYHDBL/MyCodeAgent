{
  "version": "1.1",
  "suite": "long_horizon",
  "tasks": [
    {
      "id": "long-01-memory-compress",
      "name": "Long-horizon memory with compression",
      "category": "long",
      "env": {
        "CONTEXT_WINDOW": "500",
        "COMPRESSION_THRESHOLD": "0.5",
        "MIN_RETAIN_ROUNDS": "2"
      },
      "turns": [
        "请记住以下结构化配置（固定 schema），稍后我会要求你原样输出 JSON。schema: {\"project_code\": string, \"maintainer\": {\"name\": string, \"team\": string}, \"ports\": number[], \"policy\": {\"dangerous_ops\": string, \"data_scope\": string}}。具体值如下：{\"project_code\": \"ORION\", \"maintainer\": {\"name\": \"Lin\", \"team\": \"Infra\"}, \"ports\": [8081, 9090], \"policy\": {\"dangerous_ops\": \"FORBID_BASH\", \"data_scope\": \"PROJECT_ONLY\"}}。请回复 ACK 并重复该 JSON。",
        "请用一句话描述当前项目的主要目标（无需查看文件）。",
        "再给我三个你会优先使用的内置工具名称。",
        "请解释工具输出过大时你会怎么做（两句话）。",
        "请总结你对上下文压缩的理解（两句话）。",
        "现在请仅输出 JSON（不加解释），字段顺序任意，内容必须与一开始提供的 schema 值一致。"
      ],
      "checks": [
        {
          "type": "output_json_match",
          "expected": {
            "project_code": "ORION",
            "maintainer": {"name": "Lin", "team": "Infra"},
            "ports": [8081, 9090],
            "policy": {"dangerous_ops": "FORBID_BASH", "data_scope": "PROJECT_ONLY"}
          }
        },
        {"type": "trace_event_present", "event": "history_compression_triggered"}
      ]
    },
    {
      "id": "long-02-truncation-strategy",
      "name": "Tool output truncation handling",
      "category": "long",
      "env": {
        "TOOL_OUTPUT_MAX_LINES": "200",
        "TOOL_OUTPUT_MAX_BYTES": "10240",
        "TOOL_OUTPUT_TRUNCATE_DIRECTION": "head"
      },
      "prompt": "请使用 Read 工具读取 eval/fixtures/long/large_log.txt（先不设置 start_line/limit）。如果输出被截断，请根据提示继续分段读取，最终告诉我最后一行内容，并简述你是如何找到最后一行的。禁止使用 Bash。",
      "checks": [
        {"type": "output_contains", "all": ["LINE_1000", "KIWI"]},
        {"type": "trace_tools_exclude", "tools": ["Bash"]},
        {"type": "tool_output_created", "glob": "tool-output/tool_*.json"}
      ]
    }
  ]
}
