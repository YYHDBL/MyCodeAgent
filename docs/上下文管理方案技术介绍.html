<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Agent 上下文管理方案</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            line-height: 1.8;
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 60px 40px; }
        .slide {
            background: white;
            border-radius: 12px;
            padding: 60px 70px;
            margin: 40px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            page-break-after: always;
        }
        .slide.cover { text-align: center; padding: 100px 70px; }
        .slide h1 {
            font-size: 42px;
            color: #1a1a2e;
            margin-bottom: 20px;
            font-weight: 600;
        }
        .slide.cover h1 { font-size: 52px; color: #2563eb; }
        .slide h2 {
            font-size: 28px;
            color: #1e3a8a;
            margin: 40px 0 30px 0;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
            font-weight: 500;
        }
        .slide h3 {
            font-size: 20px;
            color: #374151;
            margin: 25px 0 15px 0;
            font-weight: 600;
        }
        .slide p { font-size: 16px; margin: 12px 0; color: #4b5563; }
        .slide ul { margin: 15px 0 15px 30px; }
        .slide li { font-size: 15px; margin: 10px 0; color: #4b5563; }
        .subtitle { text-align: center; font-size: 20px; color: #6b7280; margin-bottom: 60px; }
        .version { text-align: center; font-size: 14px; color: #9ca3af; margin-top: 80px; }
        .principle-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-left: 4px solid #2563eb;
            padding: 25px 30px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .principle-card h4 { color: #1e40af; margin-bottom: 10px; font-size: 18px; }
        .architecture-diagram {
            display: flex; justify-content: center; align-items: center; gap: 20px; margin: 40px 0; flex-wrap: wrap;
        }
        .arch-box {
            background: white; border: 2px solid #e5e7eb; border-radius: 10px;
            padding: 20px 30px; text-align: center; min-width: 140px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .arch-box h4 { color: #2563eb; margin-bottom: 8px; font-size: 16px; }
        .arch-box p { font-size: 13px; color: #6b7280; }
        .arch-arrow { color: #9ca3af; font-size: 24px; }
        .layer-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .layer-table th { background: #1e3a8a; color: white; padding: 15px 20px; text-align: left; font-weight: 500; }
        .layer-table td { padding: 15px 20px; border-bottom: 1px solid #e5e7eb; }
        .layer-table tr:hover { background: #f9fafb; }
        .flow-section { background: #f8fafc; border-radius: 10px; padding: 30px; margin: 25px 0; }
        .flow-item { display: flex; align-items: center; margin: 15px 0; }
        .flow-number {
            background: #2563eb; color: white; width: 32px; height: 32px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: bold; margin-right: 15px; flex-shrink: 0;
        }
        .flow-text { font-size: 15px; color: #374151; }
        .highlight { color: #2563eb; font-weight: 500; }
        .metrics-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 30px 0; }
        .metric-card {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-radius: 10px; padding: 25px; text-align: center;
        }
        .metric-value { font-size: 36px; font-weight: 700; color: #1e40af; margin-bottom: 5px; }
        .metric-label { font-size: 14px; color: #6b7280; }
        .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start; }
        .section-card { background: #f9fafb; border-radius: 8px; padding: 25px; }
        .section-card h4 { color: #1e3a8a; margin-bottom: 15px; font-size: 17px; }
        @media print { body { background: white; } .slide { box-shadow: none; margin: 0; page-break-after: always; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="slide cover">
            <h1>Code Agent 上下文管理方案</h1>
            <p class="subtitle">基于 ReAct 模式的智能对话架构设计</p>
            <div class="version">
                <p>MyCodeAgent 框架 · v1.0</p>
            </div>
        </div>

        <div class="slide">
            <h2>设计理念</h2>
            <div class="principle-card">
                <h4>核心目标</h4>
                <p>构建一个能够理解、记忆并持续学习的对话系统，在有限的注意力资源下实现<span class="highlight">高效的信息传递与决策支持</span>。</p>
            </div>
            <div class="two-col">
                <div class="section-card">
                    <h4>连贯性保障</h4>
                    <p>通过智能的消息管理和上下文维护，确保长对话中的逻辑一致性和信息连续性。</p>
                </div>
                <div class="section-card">
                    <h4>高效性优先</h4>
                    <p>在有限的 Token 预算内，通过压缩机制和智能筛选，最大化有价值信息的密度。</p>
                </div>
                <div class="section-card">
                    <h4>可追溯性</h4>
                    <p>完整的操作记录和会话追踪，支持事后分析、问题定位和系统优化。</p>
                </div>
                <div class="section-card">
                    <h4>自适应能力</h4>
                    <p>系统能够根据对话长度和内容复杂度，自动调整上下文策略。</p>
                </div>
            </div>
        </div>

        <div class="slide">
            <h2>系统架构</h2>
            <p>采用<span class="highlight">分层设计</span>思想，将上下文管理拆解为职责清晰、相互协作的模块。</p>
            <div class="architecture-diagram">
                <div class="arch-box"><h4>配置层</h4><p>参数管理</p></div>
                <span class="arch-arrow">→</span>
                <div class="arch-box"><h4>数据层</h4><p>消息定义</p></div>
                <span class="arch-arrow">→</span>
                <div class="arch-box"><h4>业务层</h4><p>状态管理</p></div>
                <span class="arch-arrow">→</span>
                <div class="arch-box"><h4>持久层</h4><p>日志记录</p></div>
            </div>
            <table class="layer-table">
                <tr><th>层级</th><th>核心职责</th><th>设计考量</th></tr>
                <tr><td>配置层</td><td>统一管理各类参数和运行时配置</td><td>支持运行时动态调整</td></tr>
                <tr><td>数据层</td><td>定义消息模型和序列化规范</td><td>强类型约束确保数据一致性</td></tr>
                <tr><td>业务层</td><td>维护对话历史、管理上下文状态</td><td>封装复杂逻辑，提供简洁接口</td></tr>
                <tr><td>持久层</td><td>记录完整会话轨迹和统计数据</td><td>双格式存储兼顾分析和审阅</td></tr>
            </table>
        </div>

        <div class="slide">
            <h2>上下文窗口管理</h2>
            <p>大语言模型的注意力窗口有限，如何在这个约束下实现最佳体验是设计的核心挑战。</p>
            <div class="metrics-grid">
                <div class="metric-card"><div class="metric-value">30%</div><div class="metric-label">系统提示</div></div>
                <div class="metric-card"><div class="metric-value">50%</div><div class="metric-label">对话历史</div></div>
                <div class="metric-card"><div class="metric-value">20%</div><div class="metric-label">输出预留</div></div>
            </div>
            <div class="flow-section">
                <h3>智能压缩机制</h3>
                <div class="flow-item"><div class="flow-number">1</div><div class="flow-text">实时监控上下文窗口的使用率</div></div>
                <div class="flow-item"><div class="flow-number">2</div><div class="flow-text">当使用率超过阈值时触发压缩流程</div></div>
                <div class="flow-item"><div class="flow-number">3</div><div class="flow-text">调用 LLM 生成当前对话的智能摘要</div></div>
                <div class="flow-item"><div class="flow-number">4</div><div class="flow-text">保留摘要和最近 N 轮对话，清理早期内容</div></div>
            </div>
        </div>

        <div class="slide">
            <h2>历史记录策略</h2>
            <p>设计一套平衡<span class="highlight">记忆深度</span>与<span class="highlight">响应效率</span>的保留机制。</p>
            <div class="principle-card" style="border-left-color: #059669; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);">
                <h4 style="color: #047857;">三维保留原则</h4>
                <ul>
                    <li><strong>时间维度</strong>：优先保留最近的对话轮次</li>
                    <li><strong>价值维度</strong>：通过摘要机制提取和保留高价值信息</li>
                    <li><strong>容量维度</strong>：设置合理的上限，避免历史记录无限增长</li>
                </ul>
            </div>
            <div class="two-col">
                <div class="section-card">
                    <h4>消息类型管理</h4>
                    <ul>
                        <li><span class="highlight">用户消息</span> - 记录原始请求</li>
                        <li><span class="highlight">助手回复</span> - 保存 AI 的响应</li>
                        <li><span class="highlight">摘要消息</span> - 存储压缩后的关键信息</li>
                        <li><span class="highlight">工具结果</span> - 记录外部调用的输出</li>
                    </ul>
                </div>
                <div class="section-card">
                    <h4>生命周期管理</h4>
                    <ul>
                        <li>创建时记录时间戳和元数据</li>
                        <li>活跃期参与上下文构建</li>
                        <li>压缩时可能被摘要替代</li>
                        <li>过期时从活跃历史中移除</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="slide">
            <h2>追踪与监控</h2>
            <p>完善的可观测性是系统迭代和问题排查的基础。</p>
            <div class="flow-section">
                <h3>会话追踪体系</h3>
                <div class="two-col">
                    <div>
                        <h4>记录内容</h4>
                        <ul>
                            <li>会话唯一标识和时间范围</li>
                            <li>完整的消息流和交互序列</li>
                            <li>工具调用详情和执行结果</li>
                            <li>Token 使用统计数据</li>
                        </ul>
                    </div>
                    <div>
                        <h4>双格式存储</h4>
                        <ul>
                            <li><strong>JSONL 格式</strong>：结构化数据，便于程序分析</li>
                            <li><strong>Markdown 格式</strong>：可读性强，方便人工审阅</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="principle-card">
                <h4>设计价值</h4>
                <p>通过完整的追踪日志，开发人员可以重现问题场景、分析对话模式、优化上下文策略。</p>
            </div>
        </div>

        <div class="slide">
            <h2>数据流转</h2>
            <p>一次完整的对话交互涉及多个环节的数据流动和处理。</p>
            <div class="flow-section">
                <div class="flow-item"><div class="flow-number">1</div><div class="flow-text">用户输入创建用户消息对象</div></div>
                <div class="flow-item"><div class="flow-number">2</div><div class="flow-text">消息加入 Agent 的历史记录</div></div>
                <div class="flow-item"><div class="flow-number">3</div><div class="flow-text">基于历史上下文调用 LLM API</div></div>
                <div class="flow-item"><div class="flow-number">4</div><div class="flow-text">接收 LLM 回复创建助手消息</div></div>
                <div class="flow-item"><div class="flow-number">5</div><div class="flow-text">将消息记录到追踪日志</div></div>
                <div class="flow-item"><div class="flow-number">6</div><div class="flow-text">检查上下文窗口，必要时触发压缩</div></div>
            </div>
        </div>

        <div class="slide">
            <h2>最佳实践</h2>
            <p>在实际使用中，遵循这些指导原则可以获得更好的体验。</p>
            <div class="two-col">
                <div class="section-card">
                    <h4>使用建议</h4>
                    <ul>
                        <li>定期关注 Token 使用情况</li>
                        <li>根据模型能力设置合理的压缩阈值</li>
                        <li>善用文件提及功能</li>
                        <li>长对话结束后及时清理历史</li>
                    </ul>
                </div>
                <div class="section-card">
                    <h4>注意事项</h4>
                    <ul>
                        <li>避免在单次对话中处理超大文件</li>
                        <li>重要信息应在对话中明确提及</li>
                        <li>复杂任务考虑拆分为多个子任务</li>
                        <li>利用日志分析优化上下文策略</li>
                    </ul>
                </div>
            </div>
            <div class="principle-card" style="border-left-color: #dc2626; background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);">
                <h4 style="color: #dc2626;">核心原则</h4>
                <p>上下文管理的本质是在<span class="highlight">信息完整性</span>和<span class="highlight">响应效率</span>之间找到最佳平衡点。</p>
            </div>
        </div>

        <div class="slide cover">
            <h2>未来展望</h2>
            <p class="subtitle">持续演进，追求更智能的上下文管理</p>
            <div class="two-col">
                <div class="section-card">
                    <h4>智能化增强</h4>
                    <ul>
                        <li>自动识别和评分消息的重要性</li>
                        <li>基于语义相似度的历史检索</li>
                        <li>多模态内容的上下文支持</li>
                    </ul>
                </div>
                <div class="section-card">
                    <h4>架构演进</h4>
                    <ul>
                        <li>跨会话的知识库和经验积累</li>
                        <li>自适应的压缩策略</li>
                        <li>工具系统的上下文感知能力</li>
                    </ul>
                </div>
            </div>
            <div class="version">
                <p>感谢阅读</p>
                <p style="margin-top: 10px;">MyCodeAgent 框架</p>
            </div>
        </div>
    </div>
</body>
</html>